---
- name: PostgreSQL user HOME directory
  block:

    - name: Getent passwd
      ansible.builtin.getent:
        database: passwd

    - name: Set a variable for the HOME directory of the postgres user
      ansible.builtin.set_fact:
        postgresql_postgres_home: "{{ user.value[4] }}"
      when: user.key == postgresql_superuser | default('postgres')
      loop: "{{ getent_passwd | dict2items }}"
      loop_control:
        loop_var: user
        label: "{{ user.key }}"

    - name: Debug the postgres HOME directory
      ansible.builtin.debug:
        var: postgresql_postgres_home
        verbosity: 1

  tags:
    - postgresql
...
